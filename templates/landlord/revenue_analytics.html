<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revenue Analytics - GhanaRentals</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .revenue-dashboard {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px 0;
        }

        .dashboard-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 50px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            margin: 0 auto;
            max-width: 1400px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            margin-bottom: 30px;
        }

        .metric-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .metric-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        .metric-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .revenue-icon { background: linear-gradient(135deg, #27ae60, #2ecc71); }
        .property-icon { background: linear-gradient(135deg, #3498db, #2980b9); }
        .performance-icon { background: linear-gradient(135deg, #e67e22, #f39c12); }
        .trend-icon { background: linear-gradient(135deg, #9b59b6, #8e44ad); }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-item {
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
            font-weight: 600;
        }

        .trend-up { color: #27ae60; }
        .trend-down { color: #e74c3c; }
        .trend-neutral { color: #95a5a6; }

        .property-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
            transition: all 0.3s ease;
        }

        .property-card:hover {
            transform: translateX(5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .property-card.best-performer {
            border-left-color: #27ae60;
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.1), rgba(46, 204, 113, 0.1));
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 800;
            color: #2c3e50;
            margin-bottom: 30px;
            text-align: center;
        }

        .no-data {
            text-align: center;
            padding: 40px 20px;
            color: #bdc3c7;
        }

        .no-data i {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .back-button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            margin-bottom: 30px;
        }

        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            color: white;
        }
    </style>
</head>
<body class="revenue-dashboard">
    <div class="container">
        <div class="dashboard-container">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <a href="/admin/landlord-dashboard" class="back-button">
                    <i class="fas fa-arrow-left"></i>
                    Back to Dashboard
                </a>
                <h1 class="display-6 fw-bold text-primary">
                    <i class="fas fa-chart-line me-3"></i>Revenue Analytics
                </h1>
            </div>

            <!-- Flash Messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ 'success' if category == 'success' else 'danger' }} alert-dismissible fade show">
                            <i class="fas fa-{{ 'check-circle' if category == 'success' else 'exclamation-triangle' }} me-2"></i>
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <!-- Revenue Overview -->
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon revenue-icon">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div>
                        <h3 class="mb-1">Revenue Overview</h3>
                        <p class="text-muted mb-0">Your portfolio financial performance</p>
                    </div>
                </div>
                
                {% if metrics %}
                <div class="stat-grid">
                    <div class="stat-item">
                        <div class="stat-value text-success">GHS {{ "%.2f"|format(metrics.monthly_revenue or 0) }}</div>
                        <div class="stat-label">Monthly Revenue</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value text-primary">GHS {{ "%.2f"|format(metrics.annual_revenue or 0) }}</div>
                        <div class="stat-label">Annual Revenue</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value text-info">{{ metrics.total_properties or 0 }}</div>
                        <div class="stat-label">Total Properties</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value text-warning">{{ "%.1f"|format(metrics.occupancy_rate or 0) }}%</div>
                        <div class="stat-label">Occupancy Rate</div>
                    </div>
                </div>
                {% else %}
                <div class="no-data">
                    <i class="fas fa-chart-bar"></i>
                    <p>No revenue data available</p>
                </div>
                {% endif %}
            </div>

            <!-- Property Performance -->
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon performance-icon">
                        <i class="fas fa-home"></i>
                    </div>
                    <div>
                        <h3 class="mb-1">Property Performance</h3>
                        <p class="text-muted mb-0">Individual property revenue and performance</p>
                    </div>
                </div>
                
                {% if metrics.portfolio_performance %}
                <div class="row">
                    {% for property in metrics.portfolio_performance %}
                    <div class="col-md-6 mb-3">
                        <div class="property-card {% if loop.first %}best-performer{% endif %}">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="mb-1">{{ property.title }}</h5>
                                {% if loop.first %}
                                <span class="badge bg-success">
                                    <i class="fas fa-star me-1"></i>Best Performer
                                </span>
                                {% endif %}
                            </div>
                            <div class="row text-center">
                                <div class="col-4">
                                    <div class="fw-bold text-success">GHS {{ "%.0f"|format(property.monthly_rent) }}</div>
                                    <small class="text-muted">Monthly Rent</small>
                                </div>
                                <div class="col-4">
                                    <div class="fw-bold text-primary">{{ property.views }}</div>
                                    <small class="text-muted">Views</small>
                                </div>
                                <div class="col-4">
                                    <div class="fw-bold text-info">{{ "%.1f"|format(property.performance_score) }}</div>
                                    <small class="text-muted">Score</small>
                                </div>
                            </div>
                            <div class="mt-2">
                                <a href="/admin/landlord-property-analytics/{{ property.property_id }}" 
                                   class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-chart-line me-1"></i>View Details
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="no-data">
                    <i class="fas fa-home"></i>
                    <p>No property performance data available</p>
                </div>
                {% endif %}
            </div>

            <!-- Revenue Trends -->
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon trend-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div>
                        <h3 class="mb-1">Revenue Trends</h3>
                        <p class="text-muted mb-0">Monthly revenue trends over time</p>
                    </div>
                </div>
                
                {% if metrics.revenue_trends %}
                <div class="chart-container">
                    <canvas id="revenueChart"></canvas>
                </div>
                {% else %}
                <div class="no-data">
                    <i class="fas fa-chart-line"></i>
                    <p>No trend data available</p>
                </div>
                {% endif %}
            </div>

            <!-- Property Type Breakdown -->
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon property-icon">
                        <i class="fas fa-tags"></i>
                    </div>
                    <div>
                        <h3 class="mb-1">Property Type Breakdown</h3>
                        <p class="text-muted mb-0">Revenue by property type</p>
                    </div>
                </div>
                
                {% if metrics.property_breakdown %}
                <div class="row">
                    {% for breakdown in metrics.property_breakdown %}
                    <div class="col-md-4 mb-3">
                        <div class="stat-item">
                            <div class="stat-value text-primary">{{ breakdown.count }}</div>
                            <div class="stat-label">{{ breakdown.type }}</div>
                            <div class="mt-2">
                                <small class="text-muted">GHS {{ "%.0f"|format(breakdown.monthly_revenue) }}/month</small>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="no-data">
                    <i class="fas fa-tags"></i>
                    <p>No property type data available</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    {% if metrics.revenue_trends %}
    <script>
        // Revenue Trends Chart
        const ctx = document.getElementById('revenueChart').getContext('2d');
        const revenueData = {{ metrics.revenue_trends | tojson }};
        
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: revenueData.map(item => item.month),
                datasets: [{
                    label: 'Monthly Revenue (GHS)',
                    data: revenueData.map(item => item.revenue),
                    borderColor: '#27ae60',
                    backgroundColor: 'rgba(39, 174, 96, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return 'GHS ' + value.toLocaleString();
                            }
                        }
                    }
                }
            }
        });
    </script>
    {% endif %}
</body>
</html>
